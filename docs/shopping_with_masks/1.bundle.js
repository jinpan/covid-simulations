(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{18:function(t,e,n){"use strict";var o=n.w[t.i];t.exports=o;n(8);o.m()},19:function(t,e){function n(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}n.keys=function(){return[]},n.resolve=n,t.exports=n,n.id=19},8:function(t,e,n){"use strict";(function(t){n.d(e,"o",(function(){return b})),n.d(e,"j",(function(){return v})),n.d(e,"k",(function(){return E})),n.d(e,"m",(function(){return j})),n.d(e,"i",(function(){return B})),n.d(e,"a",(function(){return I})),n.d(e,"e",(function(){return C})),n.d(e,"h",(function(){return N})),n.d(e,"g",(function(){return O})),n.d(e,"b",(function(){return T})),n.d(e,"c",(function(){return D})),n.d(e,"d",(function(){return L})),n.d(e,"f",(function(){return S})),n.d(e,"n",(function(){return q})),n.d(e,"l",(function(){return M}));var o=n(18);let s=new("undefined"==typeof TextDecoder?(0,t.require)("util").TextDecoder:TextDecoder)("utf-8",{ignoreBOM:!0,fatal:!0});s.decode();let i=null;function r(){return null!==i&&i.buffer===o.f.buffer||(i=new Uint8Array(o.f.buffer)),i}function l(t,e){return s.decode(r().subarray(t,t+e))}const a=new Array(32).fill(void 0);a.push(void 0,null,!0,!1);let c=a.length;function u(t){c===a.length&&a.push(a.length+1);const e=c;return c=a[e],a[e]=t,e}function d(t){return a[t]}let h=0;let p=new("undefined"==typeof TextEncoder?(0,t.require)("util").TextEncoder:TextEncoder)("utf-8");const f="function"==typeof p.encodeInto?function(t,e){return p.encodeInto(t,e)}:function(t,e){const n=p.encode(t);return e.set(n),{read:t.length,written:n.length}};let _=null;function g(){return null!==_&&_.buffer===o.f.buffer||(_=new Int32Array(o.f.buffer)),_}function m(t){const e=d(t);return function(t){t<36||(a[t]=c,c=t)}(t),e}let w=32;function y(t){return null==t}function b(t,e){try{var n=o.e(function(t){if(1==w)throw new Error("out of js stack");return a[--w]=t,w}(t),!y(e),y(e)?0:e);return x.__wrap(n)}finally{a[w++]=void 0}}function k(t,e){return r().subarray(t/1,t/1+e)}class x{static __wrap(t){const e=Object.create(x.prototype);return e.ptr=t,e}free(){const t=this.ptr;this.ptr=0,o.a(t)}step(){return o.k(this.ptr)>>>0}to_json(){return m(o.l(this.ptr))}get_background_viral_particles(){return m(o.g(this.ptr))}get_households(){return m(o.h(this.ptr))}get_roads(){return m(o.i(this.ptr))}get_stores(){return m(o.j(this.ptr))}}const v=function(t,e){return u(JSON.parse(l(t,e)))},E=function(t,e){const n=d(e);var s=function(t,e,n){if(void 0===n){const n=p.encode(t),o=e(n.length);return r().subarray(o,o+n.length).set(n),h=n.length,o}let o=t.length,s=e(o);const i=r();let l=0;for(;l<o;l++){const e=t.charCodeAt(l);if(e>127)break;i[s+l]=e}if(l!==o){0!==l&&(t=t.slice(l)),s=n(s,o,o=l+3*t.length);const e=r().subarray(s+l,s+o);l+=f(t,e).written}return h=l,s}(JSON.stringify(void 0===n?null:n),o.c,o.d),i=h;g()[t/4+1]=i,g()[t/4+0]=s},j=function(t){m(t)},B=function(t){return void 0===d(t)},I=function(t){return u(d(t).buffer)},C=function(t,e,n){return u(new Float32Array(d(t),e>>>0,n>>>0))},N=(A=function(){return u(self.self)},function(){try{return A.apply(this,arguments)}catch(t){o.b(u(t))}});var A;const O=function(t,e){return u(n(19)(l(t,e)))},T=function(t){return u(d(t).crypto)},D=function(t){return u(d(t).getRandomValues)},L=function(t,e,n){d(t).getRandomValues(k(e,n))},S=function(t,e,n){d(t).randomFillSync(k(e,n))},q=function(t,e){throw new Error(l(t,e))},M=function(){return u(o.f)}}).call(this,n(17)(t))},9:function(t,e,n){"use strict";n.d(e,"c",(function(){return l})),n.d(e,"b",(function(){return a})),n.d(e,"a",(function(){return p}));var o=n(8),s=n(12),i=n(10),r=(n(11),n(16));const l=600,a=400,c={susceptible:12122047,exposed:13089321,infectious:15426435,recovered:13158600},u=(new s.f).parse(r),d={height:50,scales:{x:{time:!1},y:{range:[0,200]}},axes:[{show:!1},{show:!1}],cursor:{show:!1},legend:{show:!1},series:[{},{stroke:"gray",fill:"rgba(200,200,200,1)",points:{show:!1}},{stroke:"green",fill:"rgba(184,247,191,1)",points:{show:!1}},{stroke:"red",fill:"rgba(235,99,131,1)",points:{show:!1}},{stroke:"yellow",fill:"rgba(199,186,41,1)",points:{show:!1}}]};let h=[];class p{constructor(t){this.config=Object.assign({},t),this.world=o.o(t.engine_config,t.initial_seed),this._play=!1,this.speed=1,this.reset_uplot(this.config),this.reset_three(this.config,this.world),this.register_buttons(),h.push(this)}reset_uplot(){this.uplot_el=document.getElementById(this.config.name+"-uplot");let t=this.uplot_el.clientWidth,e=Object.assign({},d);e.scales.y.range=[0,this.config.engine_config.num_people],e.width=t,this.uplot_data=[Array.from(Array(t).keys()),[],[],[],[]],void 0===this.uplot_inst?this.uplot_inst=new i.a(e,this.uplot_data,this.uplot_el):this.uplot_inst.setData(this.uplot_data),this.next_chart_update_tick=0}reset_three(){this.scene=new s.o,""!=this.config.map_name&&this.draw_map(this.world,this.scene),this.draw_people(this.world,this.scene),this.draw_background(this.world,this.scene),this.camera=new s.k(0,l,a,0,0,1e3),this.camera.position.z=5;let t=document.getElementById(this.config.name+"-canvas");this.renderer=new s.q({canvas:t}),this.renderer.setClearColor(16448250,1),this.renderer.render(this.scene,this.camera)}draw_map(t,e){let n=new s.j,o=new s.g({color:3355443,linewidth:1}),i=new s.j({color:3355443}),r=new s.j({color:11184810,side:s.d,transparent:!0,opacity:.4});const l=new s.p("1x",{font:u,size:15}),a=new s.p("2x",{font:u,size:15});this.household_supply_level_meters=[];for(const c of t.get_households()){let t=c.bounds,u=t.right-t.left,d=t.top-t.bottom,h=new s.l(u,d,1),p=new s.i(h,n);p.position.x=(t.left+t.right)/2,p.position.y=(t.bottom+t.top)/2;let f=new s.e(h),_=new s.h(f,o);if(_.position.x=(t.left+t.right)/2,_.position.y=(t.bottom+t.top)/2,e.add(_),this.config.show_household_supplies){let n=c.supply_levels/this.config.show_household_supplies.max_supplies;n>1?n=1:n<0&&(n=0);const o=d*n;let r=new s.l(2,d,1),l=new s.i(r,i);l.scale.y=n,l.position.x=t.left+1,l.position.y=t.bottom+o/2,this.household_supply_level_meters.push(l),e.add(l)}if(this.config.show_dual_shopper){let n=c.dual_shopper?a:l,o=new s.i(n,r);o.position.x=t.left+5,o.position.y=t.bottom+2,e.add(o)}}let c=new s.j;for(const n of t.get_stores()){let t=n.right-n.left,o=n.top-n.bottom,i=new s.l(t,o,1),r=new s.i(i,c);r.position.x=(n.left+n.right)/2,r.position.y=(n.bottom+n.top)/2;let l=new s.a(r,0);e.add(l)}let d=new s.j({color:3355443});for(const n of t.get_roads()){let t=n.right-n.left,o=n.top-n.bottom,i=new s.l(t,o,1),r=new s.i(i,d);r.position.x=(n.left+n.right)/2,r.position.y=(n.bottom+n.top)/2,e.add(r)}}draw_people(t,e){let n=new s.b(4,32);const o={regular:{geo:new s.n(4,5,32),mat:new s.g({color:3355443,linewidth:1})},n95:{geo:new s.n(4,6,32),mat:new s.g({color:3355443,linewidth:4})}};this.people_by_id=new Map;for(const i of t.to_json().people){let t=c[i.ds],r=new s.j({color:t}),l=new s.i(n,r);l.renderOrder=2,l.position.x=i.px,l.position.y=i.py,this.people_by_id.set(i.id,{person:l}),e.add(l);let a=o[i.mask];if(void 0!==a){let t=new s.i(a.geo,a.mat);t.position.x=i.px,t.position.y=i.py,this.people_by_id.get(i.id).mask=t,e.add(t)}}}draw_background(t,e){let n=l*a;this.background_color_data=new Uint8Array(3*n);for(let t=0;t<n;t++){let e=3*t;this.background_color_data[e]=Math.floor(250),this.background_color_data[e+1]=Math.floor(250),this.background_color_data[e+2]=Math.floor(250)}this.texture=new s.c(this.background_color_data,l,a,s.m),e.background=this.texture}animate_people(t){for(const e of t){let t=this.people_by_id.get(e.id),n=t.person;n.position.x=e.px,n.position.y=e.py;let o=c[e.ds];n.material.color.setHex(o);let s=t.mask;void 0!==s&&(s.position.x=e.px,s.position.y=e.py)}}animate_households(t){const e=this.config.show_household_supplies;for(let n=0;n<t.length;n++){const o=t[n],s=o.bounds;if(e){let t=o.supply_levels/e.max_supplies;t>1?t=1:t<0&&(t=0);const i=(s.top-s.bottom)*t;let r=this.household_supply_level_meters[n];r.scale.y=t,r.position.y=s.bottom+i/2}}}update_chart(t){let e={susceptible:0,exposed:0,infectious:0,recovered:0};for(const n of t)e[n.ds]+=1;const n=e.exposed,o=n+e.infectious,s=o+e.susceptible,i=s+e.recovered;if(this.uplot_data[1].push(i),this.uplot_data[2].push(s),this.uplot_data[3].push(o),this.uplot_data[4].push(n),this.uplot_data[1].length>this.uplot_data[0].length)for(let t=1;t<=4;t++)this.uplot_data[t].shift();let r=this.uplot_el.clientWidth;if(this.uplot_data[0].length!=r){this.uplot_data[0]=Array.from(Array(r).keys());const t=this.uplot_data[1].length-this.uplot_data[0].length;if(t>0)for(let e=1;e<=4;e++)this.uplot_data[e]=this.uplot_data[e].slice(t);this.uplot_inst.setSize({width:r,height:d.height})}this.uplot_inst.setData(this.uplot_data)}update_background_viral_particles(){const t=this.world.get_background_viral_particles();for(let e=0;e<l*a;e++){const n=3*e,o=t[e];let s=250+o;s=s>255?255:s;let i=250-8*o;i=i<0?0:250-8*o,this.background_color_data[n]=s,this.background_color_data[n+1]=i,this.background_color_data[n+2]=i}this.texture.needsUpdate=!0}animate(){if(!this._play)return;requestAnimationFrame(()=>{this.animate()});let t=null;for(let e=0;e<this.speed;e++){this.world.step()>this.next_chart_update_tick&&(this.next_chart_update_tick+=this.config.chart_update_period_ticks,t=this.world.to_json(),this.update_chart(t.people))}null==t&&(t=this.world.to_json()),this.animate_people(t.people),this.animate_households(t.households),"background_viral_particle"in this.config.engine_config.disease_parameters.spread_parameters&&this.update_background_viral_particles(),this.renderer.render(this.scene,this.camera)}play(){const t=!this._play;if(this._play=!0,t){for(let t=0;t<h.length;t++){let e=h[t];e!=this&&e.pause()}document.getElementById(this.config.name+"-start").innerText="Pause",this.animate()}}pause(){this._play=!1,document.getElementById(this.config.name+"-start").innerText="Start"}reset(){this.world.free(),this.world=o.o(this.config.engine_config,this.config.map_name),this.reset_uplot(),this.reset_three()}register_buttons(){let t=this;const e=t.config.name;document.getElementById(e+"-start").addEventListener("click",(function(){t._play?t.pause():t.play()})),document.getElementById(e+"-reset").addEventListener("click",(function(){t.reset()}));for(let n of document.getElementsByClassName(e+"-speed"))n.addEventListener("click",(function(){for(let t of document.getElementsByClassName(e+"-speed"))t.style["font-weight"]="normal",t.disabled=!1;this.style["font-weight"]="bold",this.disabled=!0,t.speed=parseInt(this.dataset.speed)}));for(let n of document.getElementsByClassName(e+"-pct-dual-shopper"))n.addEventListener("click",(function(){for(let t of document.getElementsByClassName(e+"-pct-dual-shopper"))t.style["font-weight"]="normal",t.disabled=!1;this.style["font-weight"]="bold",this.disabled=!0;const n=parseInt(this.dataset.pct)/100;t.config.engine_config.behavior_parameters.shopper.fraction_dual_shopper_households=n,t.reset()}));for(let n of document.getElementsByClassName(e+"-pct-mask"))n.addEventListener("click",(function(){for(let t of document.getElementsByClassName(e+"-pct-mask"))t.style["font-weight"]="normal",t.disabled=!1;this.style["font-weight"]="bold",this.disabled=!0;const n=parseInt(this.dataset.pct)/100;let o=t.config.engine_config.misc_parameters;if(o.fraction_mask=n,o.fraction_mask+o.fraction_n95_mask>1){const t=100-100*o.fraction_mask;document.querySelector(`.${e}-pct-n95-mask[data-pct="${t}"]`).click()}else t.reset()}));for(let n of document.getElementsByClassName(e+"-pct-n95-mask"))n.addEventListener("click",(function(){for(let t of document.getElementsByClassName(e+"-pct-n95-mask"))t.style["font-weight"]="normal",t.disabled=!1;this.style["font-weight"]="bold",this.disabled=!0;const n=parseInt(this.dataset.pct)/100;let o=t.config.engine_config.misc_parameters;if(o.fraction_n95_mask=n,o.fraction_mask+o.fraction_n95_mask>1){const t=100-100*o.fraction_n95_mask;document.querySelector(`.${e}-pct-mask[data-pct="${t}"]`).click()}else t.reset()}))}}}}]);