(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{16:function(t,e,n){"use strict";var o=n.w[t.i];t.exports=o;n(6);o.m()},17:function(t,e){function n(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}n.keys=function(){return[]},n.resolve=n,t.exports=n,n.id=17},6:function(t,e,n){"use strict";(function(t){n.d(e,"o",(function(){return b})),n.d(e,"k",(function(){return v})),n.d(e,"j",(function(){return E})),n.d(e,"m",(function(){return j})),n.d(e,"i",(function(){return A})),n.d(e,"a",(function(){return B})),n.d(e,"e",(function(){return I})),n.d(e,"h",(function(){return O})),n.d(e,"g",(function(){return C})),n.d(e,"b",(function(){return N})),n.d(e,"c",(function(){return D})),n.d(e,"d",(function(){return M})),n.d(e,"f",(function(){return L})),n.d(e,"n",(function(){return S})),n.d(e,"l",(function(){return U}));var o=n(16);const s=new Array(32).fill(void 0);function i(t){return s[t]}s.push(void 0,null,!0,!1);let r=0,l=null;function a(){return null!==l&&l.buffer===o.f.buffer||(l=new Uint8Array(o.f.buffer)),l}let u=new("undefined"==typeof TextEncoder?(0,t.require)("util").TextEncoder:TextEncoder)("utf-8");const c="function"==typeof u.encodeInto?function(t,e){return u.encodeInto(t,e)}:function(t,e){const n=u.encode(t);return e.set(n),{read:t.length,written:n.length}};let h=null;function d(){return null!==h&&h.buffer===o.f.buffer||(h=new Int32Array(o.f.buffer)),h}let p=new("undefined"==typeof TextDecoder?(0,t.require)("util").TextDecoder:TextDecoder)("utf-8",{ignoreBOM:!0,fatal:!0});function f(t,e){return p.decode(a().subarray(t,t+e))}p.decode();let _=s.length;function g(t){_===s.length&&s.push(s.length+1);const e=_;return _=s[e],s[e]=t,e}function w(t){const e=i(t);return function(t){t<36||(s[t]=_,_=t)}(t),e}let m=32;function y(t){return null==t}function b(t,e){try{var n=o.e(function(t){if(1==m)throw new Error("out of js stack");return s[--m]=t,m}(t),!y(e),y(e)?0:e);return x.__wrap(n)}finally{s[m++]=void 0}}function k(t,e){return a().subarray(t/1,t/1+e)}class x{static __wrap(t){const e=Object.create(x.prototype);return e.ptr=t,e}free(){const t=this.ptr;this.ptr=0,o.a(t)}step(){return o.k(this.ptr)>>>0}to_json(){return w(o.l(this.ptr))}get_background_viral_particles(){return w(o.g(this.ptr))}get_households(){return w(o.h(this.ptr))}get_roads(){return w(o.i(this.ptr))}get_stores(){return w(o.j(this.ptr))}}const v=function(t,e){const n=i(e);var s=function(t,e,n){if(void 0===n){const n=u.encode(t),o=e(n.length);return a().subarray(o,o+n.length).set(n),r=n.length,o}let o=t.length,s=e(o);const i=a();let l=0;for(;l<o;l++){const e=t.charCodeAt(l);if(e>127)break;i[s+l]=e}if(l!==o){0!==l&&(t=t.slice(l)),s=n(s,o,o=l+3*t.length);const e=a().subarray(s+l,s+o);l+=c(t,e).written}return r=l,s}(JSON.stringify(void 0===n?null:n),o.c,o.d),l=r;d()[t/4+1]=l,d()[t/4+0]=s},E=function(t,e){return g(JSON.parse(f(t,e)))},j=function(t){w(t)},A=function(t){return void 0===i(t)},B=function(t){return g(i(t).buffer)},I=function(t,e,n){return g(new Float32Array(i(t),e>>>0,n>>>0))},O=(T=function(){return g(self.self)},function(){try{return T.apply(this,arguments)}catch(t){o.b(g(t))}});var T;const C=function(t,e){return g(n(17)(f(t,e)))},N=function(t){return g(i(t).crypto)},D=function(t){return g(i(t).getRandomValues)},M=function(t,e,n){i(t).getRandomValues(k(e,n))},L=function(t,e,n){i(t).randomFillSync(k(e,n))},S=function(t,e){throw new Error(f(t,e))},U=function(){return g(o.f)}}).call(this,n(15)(t))},7:function(t,e,n){"use strict";n.d(e,"c",(function(){return l})),n.d(e,"b",(function(){return a})),n.d(e,"a",(function(){return p}));var o=n(6),s=n(10),i=n(8),r=(n(9),n(14));const l=600,a=400,u={susceptible:12122047,exposed:13089321,infectious:15426435,recovered:13158600},c=(new s.f).parse(r),h={height:50,scales:{x:{time:!1},y:{range:[0,200]}},axes:[{show:!1},{show:!1}],cursor:{show:!1},legend:{show:!1},series:[{},{stroke:"gray",fill:"rgba(200,200,200,1)",points:{show:!1}},{stroke:"green",fill:"rgba(184,247,191,1)",points:{show:!1}},{stroke:"red",fill:"rgba(235,99,131,1)",points:{show:!1}},{stroke:"yellow",fill:"rgba(199,186,41,1)",points:{show:!1}}]};let d=[];class p{constructor(t){this.config=Object.assign({},t),this.world=o.o(t.engine_config,t.map_name,t.initial_seed),this._play=!1,this.speed=1,this.reset_uplot(this.config),this.reset_three(this.config,this.world),this.register_buttons(),d.push(this)}reset_uplot(){this.uplot_el=document.getElementById(this.config.name+"-uplot");let t=this.uplot_el.clientWidth,e=Object.assign({},h);e.scales.y.range=[0,this.config.engine_config.num_people],e.width=t,this.uplot_data=[Array.from(Array(t).keys()),[],[],[],[]],void 0===this.uplot_inst?this.uplot_inst=new i.a(e,this.uplot_data,this.uplot_el):this.uplot_inst.setData(this.uplot_data),this.next_chart_update_tick=0}reset_three(){this.scene=new s.n,""!=this.config.map_name&&this.draw_map(this.world,this.scene),this.draw_people(this.world,this.scene),this.draw_background(this.world,this.scene),this.camera=new s.k(0,l,a,0,0,1e3),this.camera.position.z=5;let t=document.getElementById(this.config.name+"-canvas");this.renderer=new s.p({canvas:t}),this.renderer.setClearColor(16448250,1),this.renderer.render(this.scene,this.camera)}draw_map(t,e){let n=new s.j,o=new s.g({color:3355443,linewidth:1}),i=new s.j({color:3355443}),r=new s.j({color:11184810,side:s.d,transparent:!0,opacity:.4});const l=new s.o("1x",{font:c,size:15}),a=new s.o("2x",{font:c,size:15});this.household_supply_level_meters=[];for(const u of t.get_households()){let t=u.bounds,c=t.right-t.left,h=t.top-t.bottom,d=new s.l(c,h,1),p=new s.i(d,n);p.position.x=(t.left+t.right)/2,p.position.y=(t.bottom+t.top)/2;let f=new s.e(d),_=new s.h(f,o);if(_.position.x=(t.left+t.right)/2,_.position.y=(t.bottom+t.top)/2,e.add(_),this.config.show_household_supplies){let n=u.supply_levels/this.config.show_household_supplies.max_supplies;n>1?n=1:n<0&&(n=0);const o=h*n;let r=new s.l(2,h,1),l=new s.i(r,i);l.scale.y=n,l.position.x=t.left+1,l.position.y=t.bottom+o/2,this.household_supply_level_meters.push(l),e.add(l)}if(this.config.show_dual_shopper){let n=u.dual_shopper?a:l,o=new s.i(n,r);o.position.x=t.left+5,o.position.y=t.bottom+2,e.add(o)}}let u=new s.j;for(const n of t.get_stores()){let t=n.right-n.left,o=n.top-n.bottom,i=new s.l(t,o,1),r=new s.i(i,u);r.position.x=(n.left+n.right)/2,r.position.y=(n.bottom+n.top)/2;let l=new s.a(r,0);e.add(l)}let h=new s.j({color:3355443});for(const n of t.get_roads()){let t=n.right-n.left,o=n.top-n.bottom,i=new s.l(t,o,1),r=new s.i(i,h);r.position.x=(n.left+n.right)/2,r.position.y=(n.bottom+n.top)/2,e.add(r)}}draw_people(t,e){let n=new s.b(4,32);this.people_by_id=new Map;for(const o of t.to_json().people){let t=u[o.ds],i=new s.j({color:t}),r=new s.i(n,i);r.renderOrder=2,r.position.x=o.px,r.position.y=o.py,this.people_by_id.set(o.id,r),e.add(r)}}draw_background(t,e){let n=l*a;this.background_color_data=new Uint8Array(3*n);for(let t=0;t<n;t++){let e=3*t;this.background_color_data[e]=Math.floor(250),this.background_color_data[e+1]=Math.floor(250),this.background_color_data[e+2]=Math.floor(250)}this.texture=new s.c(this.background_color_data,l,a,s.m),e.background=this.texture}animate_people(t){for(const e of t){let t=this.people_by_id.get(e.id);t.position.x=e.px,t.position.y=e.py;let n=u[e.ds];t.material.color.setHex(n)}}animate_households(t){const e=this.config.show_household_supplies;for(let n=0;n<t.length;n++){const o=t[n],s=o.bounds;if(e){let t=o.supply_levels/e.max_supplies;t>1?t=1:t<0&&(t=0);const i=(s.top-s.bottom)*t;let r=this.household_supply_level_meters[n];r.scale.y=t,r.position.y=s.bottom+i/2}}}update_chart(t){let e={susceptible:0,exposed:0,infectious:0,recovered:0};for(const n of t)e[n.ds]+=1;const n=e.exposed,o=n+e.infectious,s=o+e.susceptible,i=s+e.recovered;if(this.uplot_data[1].push(i),this.uplot_data[2].push(s),this.uplot_data[3].push(o),this.uplot_data[4].push(n),this.uplot_data[1].length>this.uplot_data[0].length)for(let t=1;t<=4;t++)this.uplot_data[t].shift();let r=this.uplot_el.clientWidth;if(this.uplot_data[0].length!=r){this.uplot_data[0]=Array.from(Array(r).keys());const t=this.uplot_data[1].length-this.uplot_data[0].length;if(t>0)for(let e=1;e<=4;e++)this.uplot_data[e]=this.uplot_data[e].slice(t);this.uplot_inst.setSize({width:r,height:h.height})}this.uplot_inst.setData(this.uplot_data)}update_background_viral_particles(){const t=this.world.get_background_viral_particles();for(let e=0;e<l*a;e++){const n=3*e,o=t[e];let s=250+o;s=s>255?255:s;let i=250-8*o;i=i<0?0:250-8*o,this.background_color_data[n]=s,this.background_color_data[n+1]=i,this.background_color_data[n+2]=i}this.texture.needsUpdate=!0}animate(){if(!this._play)return;requestAnimationFrame(()=>{this.animate()});let t=null;for(let e=0;e<this.speed;e++){this.world.step()>this.next_chart_update_tick&&(this.next_chart_update_tick+=this.config.chart_update_period_ticks,t=this.world.to_json(),this.update_chart(t.people))}null==t&&(t=this.world.to_json()),this.animate_people(t.people),this.animate_households(t.households),"background_viral_particle"in this.config.engine_config.disease_parameters.spread_parameters&&this.update_background_viral_particles(),this.renderer.render(this.scene,this.camera)}play(){const t=!this._play;if(this._play=!0,t){for(let t=0;t<d.length;t++){let e=d[t];e!=this&&e.pause()}document.getElementById(this.config.name+"-start").innerText="Pause",this.animate()}}pause(){this._play=!1,document.getElementById(this.config.name+"-start").innerText="Start"}reset(){this.world.free(),this.world=o.o(this.config.engine_config,this.config.map_name),this.reset_uplot(),this.reset_three()}register_buttons(){let t=this;const e=t.config.name;document.getElementById(e+"-start").addEventListener("click",(function(){t._play?t.pause():t.play()})),document.getElementById(e+"-reset").addEventListener("click",(function(){t.reset()}));for(let n of document.getElementsByClassName(e+"-speed"))n.addEventListener("click",(function(){for(let t of document.getElementsByClassName(e+"-speed"))t.style["font-weight"]="normal",t.disabled=!1;this.style["font-weight"]="bold",this.disabled=!0,t.speed=parseInt(this.dataset.speed)}));for(let n of document.getElementsByClassName(e+"-pct-dual-shopper"))n.addEventListener("click",(function(){for(let t of document.getElementsByClassName(e+"-pct-dual-shopper"))t.style["font-weight"]="normal",t.disabled=!1;this.style["font-weight"]="bold",this.disabled=!0;const n=parseInt(this.dataset.pct)/100;t.config.engine_config.behavior_parameters.shopper.fraction_dual_shopper_households=n,t.reset()}))}}}}]);