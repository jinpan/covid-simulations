(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{16:function(t,e,n){"use strict";var o=n.w[t.i];t.exports=o;n(6);o.m()},17:function(t,e){function n(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}n.keys=function(){return[]},n.resolve=n,t.exports=n,n.id=17},6:function(t,e,n){"use strict";(function(t){n.d(e,"o",(function(){return k})),n.d(e,"k",(function(){return E})),n.d(e,"j",(function(){return j})),n.d(e,"m",(function(){return A})),n.d(e,"i",(function(){return B})),n.d(e,"a",(function(){return I})),n.d(e,"e",(function(){return O})),n.d(e,"d",(function(){return T})),n.d(e,"f",(function(){return C})),n.d(e,"h",(function(){return N})),n.d(e,"g",(function(){return M})),n.d(e,"b",(function(){return L})),n.d(e,"c",(function(){return S})),n.d(e,"n",(function(){return U})),n.d(e,"l",(function(){return z}));var o=n(16);const r=new Array(32).fill(void 0);function i(t){return r[t]}r.push(void 0,null,!0,!1);let s=0,a=null;function l(){return null!==a&&a.buffer===o.f.buffer||(a=new Uint8Array(o.f.buffer)),a}let u=new("undefined"==typeof TextEncoder?(0,t.require)("util").TextEncoder:TextEncoder)("utf-8");const c="function"==typeof u.encodeInto?function(t,e){return u.encodeInto(t,e)}:function(t,e){const n=u.encode(t);return e.set(n),{read:t.length,written:n.length}};function d(t,e,n){if(void 0===n){const n=u.encode(t),o=e(n.length);return l().subarray(o,o+n.length).set(n),s=n.length,o}let o=t.length,r=e(o);const i=l();let a=0;for(;a<o;a++){const e=t.charCodeAt(a);if(e>127)break;i[r+a]=e}if(a!==o){0!==a&&(t=t.slice(a)),r=n(r,o,o=a+3*t.length);const e=l().subarray(r+a,r+o);a+=c(t,e).written}return s=a,r}let h=null;function f(){return null!==h&&h.buffer===o.f.buffer||(h=new Int32Array(o.f.buffer)),h}let p=new("undefined"==typeof TextDecoder?(0,t.require)("util").TextDecoder:TextDecoder)("utf-8",{ignoreBOM:!0,fatal:!0});function _(t,e){return p.decode(l().subarray(t,t+e))}p.decode();let g=r.length;function w(t){g===r.length&&r.push(r.length+1);const e=g;return g=r[e],r[e]=t,e}function m(t){const e=i(t);return function(t){t<36||(r[t]=g,g=t)}(t),e}let b=32;function y(t){return null==t}function k(t,e,n){try{var i=d(e,o.c,o.d),a=s,l=o.e(function(t){if(1==b)throw new Error("out of js stack");return r[--b]=t,b}(t),i,a,!y(n),y(n)?0:n);return v.__wrap(l)}finally{r[b++]=void 0}}function x(t,e){return l().subarray(t/1,t/1+e)}class v{static __wrap(t){const e=Object.create(v.prototype);return e.ptr=t,e}free(){const t=this.ptr;this.ptr=0,o.a(t)}step(){return o.k(this.ptr)>>>0}to_json(){return m(o.l(this.ptr))}get_background_viral_particles(){return m(o.g(this.ptr))}get_households(){return m(o.h(this.ptr))}get_roads(){return m(o.i(this.ptr))}get_stores(){return m(o.j(this.ptr))}}const E=function(t,e){const n=i(e);var r=d(JSON.stringify(void 0===n?null:n),o.c,o.d),a=s;f()[t/4+1]=a,f()[t/4+0]=r},j=function(t,e){return w(JSON.parse(_(t,e)))},A=function(t){m(t)},B=function(t){return void 0===i(t)},I=function(t){return w(i(t).buffer)},O=function(t,e,n){return w(new Float32Array(i(t),e>>>0,n>>>0))},T=function(t,e,n){i(t).getRandomValues(x(e,n))},C=function(t,e,n){i(t).randomFillSync(x(e,n))},N=(D=function(){return w(self.self)},function(){try{return D.apply(this,arguments)}catch(t){o.b(w(t))}});var D;const M=function(t,e){return w(n(17)(_(t,e)))},L=function(t){return w(i(t).crypto)},S=function(t){return w(i(t).getRandomValues)},U=function(t,e){throw new Error(_(t,e))},z=function(){return w(o.f)}}).call(this,n(15)(t))},7:function(t,e,n){"use strict";n.d(e,"c",(function(){return a})),n.d(e,"b",(function(){return l})),n.d(e,"a",(function(){return f}));var o=n(6),r=n(10),i=n(8),s=(n(9),n(14));const a=600,l=400,u={susceptible:12122047,exposed:13089321,infectious:15426435,recovered:13158600},c=(new r.e).parse(s),d={height:50,scales:{x:{time:!1},y:{range:[0,200]}},axes:[{show:!1},{show:!1}],cursor:{show:!1},legend:{show:!1},series:[{},{stroke:"gray",fill:"rgba(200,200,200,1)",points:{show:!1}},{stroke:"green",fill:"rgba(184,247,191,1)",points:{show:!1}},{stroke:"red",fill:"rgba(235,99,131,1)",points:{show:!1}},{stroke:"yellow",fill:"rgba(199,186,41,1)",points:{show:!1}}]};let h=[];class f{constructor(t){this.config=Object.assign({},t),this.world=o.o(t.engine_config,t.map_name,t.initial_seed),this._play=!1,this.speed=1,this.reset_uplot(this.config),this.reset_three(this.config,this.world),this.register_buttons(),h.push(this)}reset_uplot(){this.uplot_el=document.getElementById(this.config.name+"-uplot");let t=this.uplot_el.clientWidth,e=Object.assign({},d);e.scales.y.range=[0,this.config.engine_config.num_people],e.width=t,this.uplot_data=[Array.from(Array(t).keys()),[],[],[],[]],void 0===this.uplot_inst?this.uplot_inst=new i.a(e,this.uplot_data,this.uplot_el):this.uplot_inst.setData(this.uplot_data),this.next_chart_update_tick=0}reset_three(){this.scene=new r.k,""!=this.config.map_name&&this.draw_map(this.world,this.scene),this.draw_people(this.world,this.scene),this.draw_background(this.world,this.scene),this.camera=new r.h(0,a,l,0,0,1e3),this.camera.position.z=5;let t=document.getElementById(this.config.name+"-canvas");this.renderer=new r.m({canvas:t}),this.renderer.sortObjects=!1,this.renderer.setClearColor(16448250,1),this.renderer.render(this.scene,this.camera)}draw_map(t,e){let n=new r.g,o=new r.g({color:11184810,side:r.d,transparent:!0,opacity:.4});const i=new r.l("1x",{font:c,size:15}),s=new r.l("2x",{font:c,size:15});for(const a of t.get_households()){let t=a.bounds,l=t.right-t.left,u=t.top-t.bottom,c=new r.i(l,u,1),d=new r.f(c,n);d.position.x=(t.left+t.right)/2,d.position.y=(t.bottom+t.top)/2;let h=new r.a(d,0);e.add(h);let f=a.dual_shopper?s:i,p=new r.f(f,o);p.position.x=t.left+5,p.position.y=t.bottom+2,e.add(p)}let a=new r.g;for(const n of t.get_stores()){let t=n.right-n.left,o=n.top-n.bottom,i=new r.i(t,o,1),s=new r.f(i,a);s.position.x=(n.left+n.right)/2,s.position.y=(n.bottom+n.top)/2;let l=new r.a(s,0);e.add(l)}let l=new r.g({color:3355443});for(const n of t.get_roads()){let t=n.right-n.left,o=n.top-n.bottom,i=new r.i(t,o,1),s=new r.f(i,l);s.position.x=(n.left+n.right)/2,s.position.y=(n.bottom+n.top)/2,e.add(s)}}draw_people(t,e){let n=new r.b(4,32);this.people_by_id=new Map;for(const o of t.to_json().people){let t=u[o.ds],i=new r.g({color:t}),s=new r.f(n,i);s.position.x=o.px,s.position.y=o.py,this.people_by_id.set(o.id,s),e.add(s)}}draw_background(t,e){let n=a*l;this.background_color_data=new Uint8Array(3*n);for(let t=0;t<n;t++){let e=3*t;this.background_color_data[e]=Math.floor(250),this.background_color_data[e+1]=Math.floor(250),this.background_color_data[e+2]=Math.floor(250)}this.texture=new r.c(this.background_color_data,a,l,r.j),e.background=this.texture}animate_people(t){for(const e of t){let t=this.people_by_id.get(e.id);t.position.x=e.px,t.position.y=e.py;let n=u[e.ds];t.material.color.setHex(n)}}update_chart(t){let e={susceptible:0,exposed:0,infectious:0,recovered:0};for(const n of t)e[n.ds]+=1;const n=e.exposed,o=n+e.infectious,r=o+e.susceptible,i=r+e.recovered;if(this.uplot_data[1].push(i),this.uplot_data[2].push(r),this.uplot_data[3].push(o),this.uplot_data[4].push(n),this.uplot_data[1].length>this.uplot_data[0].length)for(let t=1;t<=4;t++)this.uplot_data[t].shift();let s=this.uplot_el.clientWidth;if(this.uplot_data[0].length!=s){this.uplot_data[0]=Array.from(Array(s).keys());const t=this.uplot_data[1].length-this.uplot_data[0].length;if(t>0)for(let e=1;e<=4;e++)this.uplot_data[e]=this.uplot_data[e].slice(t);this.uplot_inst.setSize({width:s,height:d.height})}this.uplot_inst.setData(this.uplot_data)}update_background_viral_particles(){const t=this.world.get_background_viral_particles();for(let e=0;e<a*l;e++){const n=3*e,o=t[e];let r=250+o;r=r>255?255:r;let i=250-8*o;i=i<0?0:250-8*o,this.background_color_data[n]=r,this.background_color_data[n+1]=i,this.background_color_data[n+2]=i}this.texture.needsUpdate=!0}animate(){if(!this._play)return;requestAnimationFrame(()=>{this.animate()});let t=null;for(let e=0;e<this.speed;e++){this.world.step()>this.next_chart_update_tick&&(this.next_chart_update_tick+=this.config.chart_update_period_ticks,t=this.world.to_json(),this.update_chart(t.people))}null==t&&(t=this.world.to_json()),this.animate_people(t.people),"background_viral_particle"in this.config.engine_config.disease_parameters.spread_parameters&&this.update_background_viral_particles(),this.renderer.render(this.scene,this.camera)}play(){const t=!this._play;if(this._play=!0,t){for(let t=0;t<h.length;t++){let e=h[t];e!=this&&e.pause()}document.getElementById(this.config.name+"-start").innerText="Pause",this.animate()}}pause(){this._play=!1,document.getElementById(this.config.name+"-start").innerText="Start"}reset(){this.world.free(),this.world=o.o(this.config.engine_config,this.config.map_name),this.reset_uplot(),this.reset_three()}register_buttons(){let t=this;const e=t.config.name;document.getElementById(e+"-start").addEventListener("click",(function(){t._play?t.pause():t.play()})),document.getElementById(e+"-reset").addEventListener("click",(function(){t.reset()}));for(let n of document.getElementsByClassName(e+"-speed"))n.addEventListener("click",(function(){for(let t of document.getElementsByClassName(e+"-speed"))t.style["font-weight"]="normal",t.disabled=!1;this.style["font-weight"]="bold",this.disabled=!0,t.speed=parseInt(this.dataset.speed)}));for(let n of document.getElementsByClassName(e+"-pct-dual-shopper"))n.addEventListener("click",(function(){for(let t of document.getElementsByClassName(e+"-pct-dual-shopper"))t.style["font-weight"]="normal",t.disabled=!1;this.style["font-weight"]="bold",this.disabled=!0;const n=parseInt(this.dataset.pct)/100;t.config.engine_config.behavior_parameters.shopper.fraction_dual_shopper_households=n,t.reset()}))}}}}]);